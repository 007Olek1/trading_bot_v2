#!/bin/bash
# üìä –°–∫—Ä–∏–ø—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤ –±–æ—Ç–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

echo "üîç –ü–æ–∏—Å–∫ –ª–æ–≥–æ–≤ –±–æ—Ç–∞..."
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –ª–æ–≥–æ–≤
LOG_SOURCES=(
    "nohup.out"
    "bot.log"
    "telegram_trading_bot.log"
    "trading_bot.log"
    ".bot.log"
)

FOUND_LOG=""

# –ò—â–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ª–æ–≥ —Ñ–∞–π–ª
for log_file in "${LOG_SOURCES[@]}"; do
    if [ -f "$log_file" ]; then
        FOUND_LOG="$log_file"
        echo "‚úÖ –ù–∞–π–¥–µ–Ω –ª–æ–≥ —Ñ–∞–π–ª: $log_file"
        break
    fi
done

# –ï—Å–ª–∏ –ª–æ–≥ —Ñ–∞–π–ª –Ω–∞–π–¥–µ–Ω
if [ -n "$FOUND_LOG" ]; then
    echo ""
    echo "üìä –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:"
    echo "   –§–∞–π–ª: $FOUND_LOG"
    echo "   –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏: Ctrl+C"
    echo ""
    echo "=" | head -c 70 && echo ""
    tail -f "$FOUND_LOG"
else
    # –ï—Å–ª–∏ –Ω–µ—Ç —Ñ–∞–π–ª–∞ –ª–æ–≥–∞, —Å–º–æ—Ç—Ä–∏–º –ø—Ä–æ—Ü–µ—Å—Å –±–æ—Ç–∞
    BOT_PID=$(ps aux | grep "super_bot_v4_mtf.py" | grep -v grep | awk '{print $2}' | head -1)
    
    if [ -n "$BOT_PID" ]; then
        echo "‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω (PID: $BOT_PID)"
        echo ""
        echo "üìä –õ–æ–≥–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –ª–æ–≥–∞:"
        echo ""
        echo "   # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –±–æ—Ç"
        echo "   kill $BOT_PID"
        echo ""
        echo "   # –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤ —Ñ–∞–π–ª"
        echo "   nohup python3 super_bot_v4_mtf.py > bot.log 2>&1 &"
        echo ""
        echo "   # –ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Å–Ω–æ–≤–∞"
        echo ""
        echo "üîç –ò–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞:"
        echo ""
        # –ü—Ä–æ–±—É–µ–º –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —á–µ—Ä–µ–∑ lsof
        if command -v lsof >/dev/null 2>&1; then
            echo "üìã –§–∞–π–ª—ã –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–º:"
            lsof -p "$BOT_PID" 2>/dev/null | grep -E "log|txt|out" | head -10
        fi
    else
        echo "‚ùå –ë–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω"
        echo ""
        echo "üí° –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º:"
        echo "   nohup python3 super_bot_v4_mtf.py > bot.log 2>&1 &"
        echo ""
        echo "   –ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Å–Ω–æ–≤–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤"
    fi
fi


