#!/bin/bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ cron –∑–∞–¥–∞—á–∏ –¥–ª—è –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∏

echo "üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∏ —á–µ—Ä–µ–∑ cron..."

CRON_JOB="0 2 * * * cd /opt/bot && /usr/bin/python3 /opt/bot/auto_cleanup_system.py >> /opt/bot/logs/system/auto_cleanup.log 2>&1"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ –∑–∞–¥–∞—á–∞
if crontab -l 2>/dev/null | grep -q "auto_cleanup_system.py"; then
    echo "‚ö†Ô∏è –ó–∞–¥–∞—á–∞ –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ crontab"
    echo "   –î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —É–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—É—é –∑–∞–¥–∞—á—É –∏ –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—É—é"
else
    # –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á—É (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00 –Ω–æ—á–∏)
    (crontab -l 2>/dev/null; echo "$CRON_JOB") | crontab -
    echo "‚úÖ –ó–∞–¥–∞—á–∞ –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ crontab"
    echo "   –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 02:00"
fi

echo ""
echo "üìã –¢–µ–∫—É—â–∏–µ –∑–∞–¥–∞—á–∏ cron:"
crontab -l | grep -E "(auto_cleanup|cleanup)" || echo "   (–Ω–µ –Ω–∞–π–¥–µ–Ω–æ)"










