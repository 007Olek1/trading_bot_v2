# План интеграции TradeGPT Scalper в Super Bot V4 MTF

## Цель
Объединить логику TradeGPT Scalper (упрощенный скальпинг с фиксированным риском) с существующим Super Bot V4 MTF (многотаймфреймовая стратегия с ML).

## Ключевые улучшения из TradeGPT Scalper для интеграции:

### 1. Упрощенная логика входа (без MTF для скальпинга)
- **Текущее**: Super Bot использует 4 таймфрейма (5m, 15m, 30m, 1h)
- **Добавить**: Режим "Quick Scalp" только на 5m для быстрых сделок
- **Условия**: EMA(9) > EMA(21), Volume > avg, Momentum(14) > 0

### 2. Фиксированный риск-менеджмент
- **MIN_PROFIT_USD = 0.50** - минимальная прибыль на сделку
- **MAX_LOSS_USD = 0.15** - максимальный убыток на сделку
- **DAILY_MAX_LOSS_USD = 5.00** - дневной лимит убытка
- **TRAILING_ACTIVATION_USD = 0.35** - активация трейлинга при +$0.35
- **TRAILING_DISTANCE_PCT = 0.0015** - отступ трейлинга 0.15%

### 3. Улучшенный трейлинг
- Отмена фиксированного TP через API при активации трейлинга
- Динамическое обновление SL с минимальным интервалом 10 секунд
- Защита от некорректных значений SL (выше цены для LONG, ниже для SHORT)

### 4. Проверки безопасности
- **Временная блокировка символа** (60 сек) при ошибке установки SL/TP
- **Проверка закрытия позиции** через `fetch_positions()` с циклом ожидания (30 сек)
- **Учет комиссии Bybit** (~0.075%) в расчете TP
- **Авто-BLOCK** при превышении времени предсказания ML (> 5 мс)

### 5. Упрощенная версия без ML (для тестирования)
- Режим работы без Disco57/ML для экономии ресурсов
- Простая логика: EMA + Volume + Momentum

## Структура интеграции:

### Добавить в Super Bot V4 MTF:

1. **Новые константы** (строки ~600):
```python
# TradeGPT Scalper параметры
MIN_PROFIT_USD = 0.50
MAX_LOSS_USD = 0.15
DAILY_MAX_LOSS_USD = 5.0
TRAILING_ACTIVATION_USD = 0.35
TRAILING_DISTANCE_PCT = 0.0015
BYBIT_FEE_PCT = 0.00075
SYMBOL_COOLDOWN_SEC = 60
POSITION_CLOSE_CHECK_INTERVAL = 2
POSITION_CLOSE_MAX_WAIT = 30
TRAILING_UPDATE_MIN_INTERVAL = 10
```

2. **Новые переменные экземпляра** (в `__init__`):
```python
self.symbol_cooldowns: Dict[str, float] = {}
self.scalp_mode_enabled = True  # Включить режим скальпинга
```

3. **Новый метод `calculate_scalp_tp_sl()`** - расчет TP/SL для скальпинга

4. **Улучшенный метод `open_position_automatically()`**:
   - Добавить проверку кулдауна символа
   - Добавить установку кулдауна при ошибке SL/TP
   - Добавить учет комиссии в расчете TP

5. **Улучшенный метод трейлинга**:
   - Отмена TP через API
   - Динамическое обновление SL
   - Защита от некорректных значений

6. **Улучшенный метод закрытия позиции**:
   - Проверка через `fetch_positions()` с циклом ожидания

## Файлы для создания:

1. **`tradegpt_scalper_integration.py`** - модуль интеграции
2. **`super_bot_v5_integrated.py`** - обновленная версия супер бота

## Следующие шаги:

1. ✅ Остановить TradeGPT Scalper Lite
2. ✅ Скачать super_bot_v4_mtf.py с сервера
3. ⏳ Создать интегрированную версию
4. ⏳ Загрузить на сервер
5. ⏳ Перезапустить супер бот
6. ⏳ Протестировать на 20 сделках
